language: rust
cache: cargo
matrix:
  include:
  - os: linux
    rust: stable
    env: TARGET=x86_64-unknown-linux-gnu
  - os: linux
    rust: stable
    env: TARGET=x86_64-unknown-linux-musl
  - os: linux
    rust: stable
    env: TARGET=i686-unknown-linux-musl
  - os: osx
    rust: stable
    env: TARGET=x86_64-apple-darwin
  - os: linux
    rust: 1.33.0
    env: TARGET=x86_64-unknown-linux-gnu
  - os: linux
    rust: 1.33.0
    env: TARGET=x86_64-unknown-linux-musl
  - os: linux
    rust: 1.33.0
    env: TARGET=i686-unknown-linux-musl
  - os: osx
    rust: 1.33.0
    env: TARGET=x86_64-apple-darwin
env:
  global:
  - HOST=x86_64-unknown-linux-gnu
  - PROJECT_NAME=rust_init
install:
- if [[ $TRAVIS_OS_NAME = linux && $HOST != $TARGET ]]; then rustup target add $TARGET;
  fi
script:
- cargo build --target $TARGET --verbose
- cargo test --target $TARGET --verbose
deploy:
  provider: releases
  api_key:
    secure: 291bcca1173fd7ea5fc47e2ee3625f0bfa254d24
  file_glob: true
  file: "/home/travis/build/jiangbo212/rust/target/$TARGET/debug/deps/hello_world*"
  skip_cleanup: true
  on:
    branch: master
notifications:
  email:
    on_success: never
